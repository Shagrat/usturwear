{% comment %}
  Terrikon Slideshow Section
  - Responsive, mobile/desktop images per slide
  - Adjustable height for desktop and mobile
  - Swiper.js CDN
{% endcomment %}

{% stylesheet %}
.terrikon-slideshow {
  position: relative;
  width: 100%;
  overflow: hidden;
  min-height: 200px;
}
.terrikon-slideshow__swiper {
  width: 100%;
}
.terrikon-slide {
  position: relative;
  width: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 1px;
}
.terrikon-slide__img {
  width: 100%;
  height: 100%;
  object-fit: contain;
  object-position: center;
  position: absolute;
  left: 0; top: 0;
  z-index: 1;
  background: #000;
}
.terrikon-slide__content {
  position: absolute;
  left: 50%;
  width: 100%;
  max-width: 700px;
  transform: translateX(-50%);
  z-index: 2;
  color: #fff;
  text-align: center;
  padding: 2rem 1rem;
  border-radius: 1rem;
}
.terrikon-slide__content--top {
  top: 2rem;
  transform: translate(-50%, 0);
}
.terrikon-slide__content--middle {
  top: 50%;
  transform: translate(-50%, -50%);
}
.terrikon-slide__content--bottom {
  bottom: 2rem;
  transform: translate(-50%, 0);
}
.terrikon-slideshow .terrikon-slide__heading.h1{
  font-size: 5.4rem;
  margin: 0 0 2.4rem;
  color: #fff;
}
@media screen and (min-width: 1200px) {
  .terrikon-slide__heading {
    font-size: 3.2rem;
    margin: 0 0 3.2rem;
  }
}
.terrikon-slide__heading:only-child {
  margin: 0;
}
.terrikon-slide__subheading {
  font-size: 2.6rem;
  line-height: 1.5;
  margin: 0 auto 4rem;
  max-width: 44rem;
  font-family: var(--font-body-family, inherit);
  font-weight: var(--font-body-weight, 400);
}
.terrikon-slide__subheading:last-child {
  margin-bottom: 0;
}
.terrikon-slide__link {
  display: inline-block;
  background: #fff;
  color: #222;
  padding: 0.7em 1.5em;
  border-radius: 2em;
  text-decoration: none;
  font-weight: bold;
  transition: background 0.2s;
}
.terrikon-slide__link:hover {
  background: #f2f2f2;
}
.terrikon-slideshow__pagination {
  position: absolute;
  left: 0; right: 0; bottom: 1.5rem;
  z-index: 10;
  text-align: center;
}
.terrikon-slideshow__pagination .swiper-pagination-bullet {
  background: #fff;
  opacity: 0.7;
}
.terrikon-slideshow__pagination .swiper-pagination-bullet-active {
  opacity: 1;
}
@media (max-width: 749px) {
  .terrikon-slide__heading { font-size: 3.4rem; }
  .terrikon-slide__subheading { font-size: 1.6rem; }
  .terrikon-slide__content { padding: 1.2rem 0.5rem; }

    .terrikon-slide__content--middle {
    top: 65%;
    transform: translate(-50%, -50%);
    }
}
{% endstylesheet %}

<script src="{{ 'swiper-bundle.min.js' | asset_url }}" defer="defer"></script>
{% javascript %}
window.addEventListener('load', function() {
  var section = document.querySelector('.terrikon-slideshow');
  if (!section) return;

  // Set dynamic height
  function setSlideshowHeight() {
    var desktopH = parseInt(section.getAttribute('data-height-desktop'), 10) || 60;
    var mobileH = parseInt(section.getAttribute('data-height-mobile'), 10) || 50;
    var vh = window.innerHeight;
    var isMobile = window.innerWidth < 750;
    var height = isMobile ? (vh * mobileH / 100) : (vh * desktopH / 100);
    section.style.height = height + 'px';
    var slides = section.querySelectorAll('.terrikon-slide');
    slides.forEach(function(slide) {
      slide.style.height = height + 'px';
    });
  }
  setSlideshowHeight();
  window.addEventListener('resize', setSlideshowHeight);

  // Only init Swiper if more than 1 slide
  var slidesCount = section.querySelectorAll('.terrikon-slide').length;
  if (slidesCount > 1) {
    new Swiper('.terrikon-slideshow__swiper', {
      loop: true,
      pagination: {
        el: '.terrikon-slideshow__pagination',
        clickable: true
      },
      autoplay: {
        delay: 4000,
        disableOnInteraction: false
      }
    });
  }
});
{% endjavascript %}

<div class="terrikon-slideshow" id="terrikon-slideshow-{{ section.id }}"
     data-height-desktop="{{ section.settings.height_desktop | default: 60 }}"
     data-height-mobile="{{ section.settings.height_mobile | default: 50 }}">
  <div class="terrikon-slideshow__swiper swiper">
    <div class="swiper-wrapper">
      {% for block in section.blocks %}
        <div class="terrikon-slide swiper-slide">
          {% if block.settings.image_desktop or block.settings.image_mobile %}
            <picture>
              {% if block.settings.image_mobile %}
                <source media="(max-width:749px)" srcset="{{ block.settings.image_mobile | image_url: width: 800 }}">
              {% endif %}
              {% if block.settings.image_desktop %}
                <img class="terrikon-slide__img"
                     src="{{ block.settings.image_desktop | image_url: width: 1920 }}"
                     alt="{{ block.settings.heading | escape }}"
                     width="{{ block.settings.image_desktop.width }}"
                     height="{{ block.settings.image_desktop.height }}">
              {% endif %}
            </picture>
          {% endif %}
          <div class="terrikon-slide__content terrikon-slide__content--{{ block.settings.text_position | default: 'middle' }}">
            {% if block.settings.heading != blank %}
              <div class="terrikon-slide__heading h1">{{ block.settings.heading }}</div>
            {% endif %}
            {% if block.settings.text != blank %}
              <div class="terrikon-slide__subheading">{{ block.settings.text }}</div>
            {% endif %}
            {% if block.settings.link != blank and block.settings.link_text != blank %}
              <a class="terrikon-slide__link" href="{{ block.settings.link }}">{{ block.settings.link_text }}</a>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
    <div class="terrikon-slideshow__pagination swiper-pagination"></div>
  </div>
</div>


{% schema %}
{
  "name": "Terrikon Slideshow",
  "settings": [
    {
      "type": "range",
      "id": "height_desktop",
      "label": "Desktop height (% of viewport)",
      "min": 30,
      "max": 100,
      "step": 1,
      "default": 60
    },
    {
      "type": "range",
      "id": "height_mobile",
      "label": "Mobile height (% of viewport)",
      "min": 30,
      "max": 100,
      "step": 1,
      "default": 50
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image_desktop",
          "label": "Desktop image"
        },
        {
          "type": "image_picker",
          "id": "image_mobile",
          "label": "Mobile image"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading"
        },
        {
          "type": "textarea",
          "id": "text",
          "label": "Text"
        },
        {
          "type": "select",
          "id": "text_position",
          "label": "Text position",
          "options": [
            { "value": "top", "label": "Top" },
            { "value": "middle", "label": "Middle" },
            { "value": "bottom", "label": "Bottom" }
          ],
          "default": "middle"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "text",
          "id": "link_text",
          "label": "Link text"
        }
      ]
    }
  ],
  "max_blocks": 10,
  "presets": [
    {
      "name": "Terrikon Slideshow",
      "category": "Image"
    }
  ]
}
{% endschema %}