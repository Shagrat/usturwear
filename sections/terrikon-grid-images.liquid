{% comment %} 
                                      Terrikon — Grid Images (compact) 
                                      - max-width: 1350px 
                                      - H2 heading 
                                      - up to 6 columns (responsive) 
                                      - image with text BELOW (no overlay, no links) 
                                      - blocks: image + alt + caption 
{% endcomment %}

<section id="terrikon-grid-images-{{ section.id }}" class="terrikon-grid-images">
  <div class="terrikon-grid-images__inner">
    <h2 class="terrikon-grid-images__title">{{ section.settings.title }}</h2>

    <div class="terrikon-grid-images__grid" style="--max-cols: {{ section.settings.max_columns | default: 6 }};">
      {% if section.blocks != empty %}
        {% for block in section.blocks %}
          <figure class="terrikon-grid-images__item">
            {% if block.settings.image %}
              <img
                src="{{ block.settings.image | img_url: '800x' }}"
                srcset="{{ block.settings.image | img_url: '400x' }} 400w, {{ block.settings.image | img_url: '800x' }} 800w, {{ block.settings.image | img_url: '1200x' }} 1200w"
                sizes="(max-width: 480px) 100vw, (max-width: 768px) 50vw, (max-width: 1200px) 33vw, 16vw"
                alt="{{ block.settings.alt_text | escape }}"
                class="terrikon-grid-images__img"
                loading="lazy" />
            {% else %}
              <div class="terrikon-grid-images__placeholder" aria-hidden="true"></div>
            {% endif %}
            {% if block.settings.caption != blank %}
              <figcaption class="terrikon-grid-images__caption">{{ block.settings.caption }}</figcaption>
            {% endif %}
          </figure>
        {% endfor %}
      {% else %}
        <!-- fallback examples -->
        {% for i in (1..4) %}
          <figure class="terrikon-grid-images__item">
            <img
              src="{{ 'techwear-2-scaled.webp' | asset_url }}"
              alt="Techwear"
              class="terrikon-grid-images__img"
              loading="lazy" />
            <figcaption class="terrikon-grid-images__caption">Sample caption {{ i }}</figcaption>
          </figure>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</section>

{% stylesheet %}
  .terrikon-grid-images {
    padding: 40px 20px;
  }
  .terrikon-grid-images__inner {
    max-width: 1350px;
    margin: 0 auto;
  }
  .terrikon-grid-images__title {
    font-size: 32px;
    margin: 0 0 24px;
  }

  /* Grid: responsive up to --max-cols (1..6) */
  .terrikon-grid-images__grid {
    display: grid;
    gap: 20px;
    margin: 0;
    grid-auto-rows: auto;
    grid-template-columns: repeat(var(--cols, 1), 1fr);
  }

  /* We'll set CSS custom property based on breakpoints and requested max */
  @media (min-width: 1600px) {
    .terrikon-grid-images__grid {
      --cols: calc(min(var(--max-cols), 6));
    }
  }
  @media (min-width: 1400px) and (max-width: 1599px) {
    .terrikon-grid-images__grid {
      --cols: calc(min(var(--max-cols), 5));
    }
  }
  @media (min-width: 1200px) and (max-width: 1399px) {
    .terrikon-grid-images__grid {
      --cols: calc(min(var(--max-cols), 4));
    }
  }
  @media (min-width: 992px) and (max-width: 1199px) {
    .terrikon-grid-images__grid {
      --cols: calc(min(var(--max-cols), 3));
    }
  }
  @media (min-width: 600px) and (max-width: 991px) {
    .terrikon-grid-images__grid {
      --cols: calc(min(var(--max-cols), 2));
    }
  }
  @media (max-width: 599px) {
    .terrikon-grid-images__grid {
      --cols: 1;
    }
  }

  /* items */
  .terrikon-grid-images__item {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin: 0;
  }

  /* Changed: make <img> render normally and responsively */
  .terrikon-grid-images__img {
    display: block;
    width: 100%;
    height: auto;
    /* ensure full image is visible */
    object-fit: cover;
    border-radius: 4px;
    overflow: hidden;
  }

  /* If you want fixed aspect ratio boxes use a wrapper (.placeholder-like) */
  .terrikon-grid-images__placeholder,
  .terrikon-grid-images__img--boxed {
    width: 100%;
    padding-bottom: 75%;
    /* fallback aspect ratio box if needed */
    background: #f2f2f2;
    border-radius: 4px;
    object-fit: cover;
    overflow: hidden;
  }

  .terrikon-grid-images__img[src=""] {
    display: none;
  }
  .terrikon-grid-images__placeholder {
    width: 100%;
    padding-bottom: 75%;
    background: #f2f2f2;
    border-radius: 4px;
  }
  .terrikon-grid-images__caption {
    font-size: 14px;
    color: #222;
    line-height: 1.4;
    margin: 0;
  }

  /* Accessibility / focus */
  .terrikon-grid-images__item:focus-within {
    outline: 3px solid rgba(0, 0, 0, 0.06);
    outline-offset: 4px;
    border-radius: 4px;
  }

  /* Small tweaks for very wide / narrow */
  @media (min-width: 1800px) {
    .terrikon-grid-images__img {
    ;
    /* if you prefer wider images on very large screens leave height:auto */
  }
}
{% endstylesheet %}

{% schema %}
  {
    "name": "Grid Images (compact)",
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Heading (H2)",
        "default": "ДЕТАЛІ"
      }, {
        "type": "range",
        "id": "max_columns",
        "label": "Max columns (desktop)",
        "min": 1,
        "max": 6,
        "step": 1,
        "default": 6
      }
    ],
    "blocks": [
      {
        "type": "card",
        "name": "Image",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "Image"
          }, {
            "type": "text",
            "id": "alt_text",
            "label": "Alt text"
          }, {
            "type": "text",
            "id": "caption",
            "label": "Caption (text below image)"
          }
        ]
      }
    ],
    "max_blocks": 24,
    "presets": [
      {
        "name": "Grid Images (compact)",
        "category": "Terrikon"
      }
    ]
  }
{% endschema %}